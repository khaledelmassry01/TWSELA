spring:
  datasource:
    url: jdbc:mysql://localhost:3306/twsela?useSSL=true&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto:  validate  # Auto-update schema for development
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        show_sql: false  # Disabled for production
        format_sql: false  # Disabled for production
    open-in-view: false
  h2:
    console:
      enabled: false
  jackson:
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
    deserialization:
      FAIL_ON_UNKNOWN_PROPERTIES: false
    default-property-inclusion: non_null
  # data:
  #   redis:
  #     host: ${REDIS_HOST:localhost}
  #     port: ${REDIS_PORT:6379}
  #     password: ${REDIS_PASSWORD:}
  #     timeout: 5000ms  # Increased timeout
  #     lettuce:
  #       pool:
  #         max-active: 16  # Increased pool size
  #         max-idle: 8
  #         min-idle: 2
  #         max-wait: -1ms

# Cache Configuration - Disabled for development
# cache:
#   type: redis
#   redis:
#     time-to-live: 1800000  # Increased to 30 minutes
#     enable-statistics: true
#     cache-null-values: false

server:
  port: 8000
  ssl:
    enabled: ${SERVER_SSL_ENABLED:false}  # Disabled for development
    key-store: ${SERVER_SSL_KEY_STORE:classpath:keystore.p12}
    key-store-password: ${SERVER_SSL_KEY_STORE_PASSWORD:changeit}
    key-store-type: PKCS12
    key-alias: tomcat
  servlet:
    context-path: /
  tomcat:
    max-threads: 200
    min-spare-threads: 20
    accept-count: 100

app:
  security:
    jwt:
      # Strong 256-bit secret key for HMAC-SHA256 (Base64 encoded)
      # In production, use environment variable: ${JWT_SECRET:}
      secret: ${JWT_SECRET:O+ERbjSi7ohmxmUgxmhg+8kzartnn2XbxMtN5n5L3Ys=}
      expiration-ms: 86400000 # 24 hours (reduced from 30 days for better security)
  cors:
    # Comma-separated list. Example: http://localhost:5173,http://localhost:3000,https://app.example.com
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://127.0.0.1:5173,http://localhost:8000,http://localhost:8080,http://localhost:3000,http://127.0.0.1:8000,http://127.0.0.1:8080,http://127.0.0.1:3000,https://localhost:3000,https://127.0.0.1:3000}

logging:
  level:
    root: WARN
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    com.twsela: INFO
  file:
    name: ${LOG_FILE_PATH:/var/log/twsela/twsela.log}
    max-size: 100MB
    max-history: 30
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Actuator Configuration for Monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,beans,configprops
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      show-components: always
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.95, 0.99
      slo:
        http.server.requests: 50ms, 100ms, 200ms, 500ms

# Swagger/OpenAPI Configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    tryItOutEnabled: true
    filter: true
    displayRequestDuration: true
    displayOperationId: false
    defaultModelsExpandDepth: 1
    defaultModelExpandDepth: 1
    docExpansion: none
    deepLinking: true
    showExtensions: true
    showCommonExtensions: true
    disable-swagger-default-url: true
  show-actuator: true
  group-configs:
    - group: 'all'
      display-name: 'All APIs'
      paths-to-match: '/**'
    - group: 'auth'
      display-name: 'Authentication APIs'
      paths-to-match: '/api/auth/**'
    - group: 'shipments'
      display-name: 'Shipment Management APIs'
      paths-to-match: '/api/shipments/**'
    - group: 'public'
      display-name: 'Public APIs'
      paths-to-match: '/api/public/**'
    - group: 'dashboard'
      display-name: 'Dashboard APIs'
      paths-to-match: '/api/dashboard/**'
    - group: 'financial'
      display-name: 'Financial APIs'
      paths-to-match: '/api/financial/**'
    - group: 'reports'
      display-name: 'Reports APIs'
      paths-to-match: '/api/reports/**'
    - group: 'master'
      display-name: 'Master Data APIs'
      paths-to-match: '/api/master/**'
    - group: 'manifests'
      display-name: 'Manifest APIs'
      paths-to-match: '/api/manifests/**'
    - group: 'settings'
      display-name: 'Settings APIs'
      paths-to-match: '/api/settings/**'
    - group: 'sms'
      display-name: 'SMS APIs'
      paths-to-match: '/api/sms/**'
    - group: 'audit'
      display-name: 'Audit APIs'
      paths-to-match: '/api/audit/**'
    - group: 'backup'
      display-name: 'Backup APIs'
      paths-to-match: '/api/backup/**'
    - group: 'health'
      display-name: 'Health Check APIs'
      paths-to-match: '/api/health/**'

# SMS Configuration
sms:
  # Provider: 'console' (development) or 'twilio' (production)
  provider: ${SMS_PROVIDER:twilio}
  # Enable/disable SMS sending
  enabled: ${SMS_ENABLED:true}

# Twilio Configuration (only needed if sms.provider=twilio)
twilio:
  # Get these from https://console.twilio.com/
  account-sid: ${TWILIO_ACCOUNT_SID:your_account_sid_here}
  auth-token: ${TWILIO_AUTH_TOKEN:your_auth_token_here}
  # Your Twilio phone number (e.g., +966xxxxxxxxx)
  phone-number: ${TWILIO_PHONE_NUMBER:+1234567890}
  # Twilio configuration
  timeout: 30000
  retry-attempts: 3
  webhook-url: ${TWILIO_WEBHOOK_URL:}

# Backup Configuration
backup:
  enabled: ${BACKUP_ENABLED:true}
  path: ${BACKUP_PATH:/var/backups/twsela}
  schedule: ${BACKUP_SCHEDULE:0 0 2 * * ?}
  retention-days: ${BACKUP_RETENTION_DAYS:30}

